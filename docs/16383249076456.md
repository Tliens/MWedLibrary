# 网易IM

- 点击表情包
```
- (void)onTouchEmoticonBtn:(id)sender
```
- 布局
```
```
```
configureNIMKit
```
- 语音

- UI库指南
https://github.com/netease-kit/NIM_iOS_UIKit‘=

- NIMKitConfig 默认配置
- cell 点击事件
```
- (BOOL)onTapCell:(NIMKitEvent *)event
```
```
- (void)showImage:(NIMMessage *)message
```
```
图片
NIMImageObject *object = message.messageObject;
    NTESGalleryItem *item = [[NTESGalleryItem alloc] init];
    item.thumbPath      = [object thumbPath];
    item.imageURL       = [object url];
    item.name           = [object displayName];
    item.itemId         = [message messageId];
    item.size           = [object size];
    item.imagePath      = [object path];
```

tableview 逻辑处理

NIMSessionTableAdapter tableview代理
NIMSessionInteractorImpl tableview 数据

autoFetchMessages  自动拉取数据

didFetchMessageData
checkAttachmentState

[self.tableView nim_scrollToBottom:NO];

loadHistoryMessagesWithComplete 拉历史消息

NIMAdvanceMenu 长按视图

- onLongPressCell 长按
- NIMInputDelegate
- NIMImageContentConfig

- 跳转到私聊会话
```
NSString *uid = [[NIMSDK sharedSDK].loginManager currentAccount];
NIMSession *session = [NIMSession session:uid type:NIMSessionTypeP2P];
NTESSessionViewController *vc = [[NTESSessionViewController alloc] initWithSession:session];
[self.navigationController pushViewController:vc animated:YES];



UINavigationController *nav = self.navigationController;
    NIMSession *session = [NIMSession session:self.userId type:NIMSessionTypeP2P];
    NTESSessionViewController *vc = [[NTESSessionViewController alloc] initWithSession:session];
    [nav pushViewController:vc animated:YES];
    UIViewController *root = nav.viewControllers[0];
    nav.viewControllers = @[root,vc];
```

#pragma mark - 消息收发接口
- (void)sendMessage:(NIMMessage *)message

表情包
+ (NIMMessage*)msgWithChartletAttachment:(NTESChartletAttachment *)attachment{

NTESChartletAttachment

NTESSessionChartletContentView


```
/**
 *    是否为房主标记
 */
@property (nonatomic, strong) UIImageView *ownerImageV;

    if (data.isOwner&&data.showName){
        [_ownerImageV setHidden:NO];
        [self setNeedsLayout];
        [self layoutIfNeeded];
    }else{
        [_ownerImageV setHidden:YES];
    }
    
    
    self.ownerImageV.mm_w = 9;
    self.ownerImageV.mm_h = 8.5;
    
        _ownerImageV = [[UIImageView alloc] init];
        _ownerImageV.image = [UIImage imageNamed:@"message_owner_tag"];
        [_ownerImageV setHidden:YES];
        [self.contentView addSubview:_ownerImageV];
```

```
- (NSArray<NIMMediaItem *> *)menuItemsWithMessage:(NIMMessage *)message {
    NSMutableArray *items = [NSMutableArray array];

    NIMMediaItem *reply = [NIMMediaItem item:@"onTapMenuItemReply:"
                                 normalImage:[UIImage imageNamed:@"menu_reply"]
                               selectedImage:nil
                                       title:@"回复".ntes_localized];
    
    NIMMediaItem *copy = [NIMMediaItem item:@"onTapMenuItemCopy:"
                                normalImage:[UIImage imageNamed:@"menu_copy"]
                              selectedImage:nil
                                      title:@"复制".ntes_localized];
    
    NIMMediaItem *forword = [NIMMediaItem item:@"onTapMenuItemForword:"
                                   normalImage:[UIImage imageNamed:@"menu_forword"]
                                 selectedImage:nil
                                         title:@"转发".ntes_localized];
    
    NIMMediaItem *mark = [NIMMediaItem item:@"onTapMenuItemMark:"
                                normalImage:[UIImage imageNamed:@"menu_collect"]
                              selectedImage:nil
                                      title:@"收藏".ntes_localized];
    
    BOOL isMessagePined = [NIMSDK.sharedSDK.chatExtendManager pinItemForMessage:message] != nil;
    NSString *pinTitle = isMessagePined ? @"Un-pin": @"Pin";
    NSString *pinAction = isMessagePined ? @"onTapMenuItemUnpin:" : @"onTapMenuItemPin:";
    NIMMediaItem *pin = [NIMMediaItem item:pinAction
                               normalImage:[UIImage imageNamed:@"menu_pin"]
                             selectedImage:nil
                                     title:pinTitle];
    
    NIMMediaItem *revoke = [NIMMediaItem item:@"onTapMenuItemRevoke:"
                                  normalImage:[UIImage imageNamed:@"menu_revoke"]
                                selectedImage:nil
                                        title:@"撤回".ntes_localized];
    
    NIMMediaItem *delete = [NIMMediaItem item:@"onTapMenuItemDelete:"
                                  normalImage:[UIImage imageNamed:@"menu_del"]
                                selectedImage:nil
                                        title:@"删除".ntes_localized];
    
    NIMMediaItem *mutiSelect = [NIMMediaItem item:@"onTapMenuItemMutiSelect:"
                                      normalImage:[UIImage imageNamed:@"menu_choose"]
                                    selectedImage:nil
                                            title:@"多选".ntes_localized];
    if ([NTESSessionUtil canMessageBeForwarded:message])
    {
        [items addObject:reply];
    }
    
    if (message.messageType == NIMMessageTypeText)
    {
        [items addObject:copy];
    }
    
    if ([NTESSessionUtil canMessageBeForwarded:message]) {
        [items addObject:forword];
    }
    if ([NTESSessionUtil canMessageBeForwarded:message]) {
        [items addObject:mark];
        [items addObject:pin];
    }
    if ([NTESSessionUtil canMessageBeRevoked:message]) {
        [items addObject:revoke];
    }
    [items addObject:delete];
    if ([NTESSessionUtil canMessageBeForwarded:message])
    {
        [items addObject:mutiSelect];
    }
    
    if (message.messageType == NIMMessageTypeAudio)
    {
        NIMMediaItem *audio2text = [NIMMediaItem item:@"onTapMenuItemAudio2Text:"
          normalImage:[UIImage imageNamed:@"menu_audio2text"]
        selectedImage:nil
                title:@"转文字".ntes_localized];
        
        [items addObject:audio2text];
    }
    return items;
}
```

- NTESGalleryViewController

## 自定义消息

NTESCustomAttachmentDefines 

NTESCustomAttachmentDecoder


shouldShowAvatar

NIMSessionImageContentView

NIMImageContentConfig

## 布局
NTESCellLayoutConfig\NIMCellLayoutConfig\NIMKitConfig
NIMImageContentConfig\








## 输入框

NIMInputView
NIMSessionLayoutImpl

# 消息
NIMSessionMsgDatasource