# Swift底层原理

## 一、编程基础
### 1、lldb 命令
- n 下一步，把子函数当做一个整体

- s 下一步，遇到子函数会进入子函数

- ni 下一步，把子函数当做一个整体(汇编级别)

- si 下一步，遇到子函数会进入子函数(汇编级别)

- finish 执行完当前所有代码，返回上一个函数（遇到断点会卡主）
### 2、汇编

#### 1、寄存器
#### 2、常用汇编语句
add 相加并赋值给后者
```
add $3,%rax
```
movq 赋值
```
movq $3,%rax
```
leaq 取内存地址赋值

rbp - 0x18 这个地址赋值给rax
```
leaq -0x18(%rbp),%rax
```
jump\callq 调用某个函数

$ 表示立即数

## 二、函数
### 1、swift中的函数
#### 0、typelias
typealias 可以给类型起别名

typealias 可以给函数起别名
#### 1、变量类型
常量

变量

可选

强制解包

空合并运算符 ??

?? 的原理

隐式解包
let num:Int! = 1

let num2:Int = num


多重可选项

查看结构
```
fr v -R num2
```

#### 2、函数类型

定义变量为函数类型

函数类型作为参数传入到函数中

函数类型作为返回值
#### 3、函数重载
方法名相同，标签名不同或参数不同或省略值不同

autoclosure 构成了函数重载

#### 4、内联函数
编译优化，决定是否将多个函数优化为一个函数

不会自动内联的情况：
- 函数体比较长
- 包含递归调用
- 包含动态派发

@inline(never) 控制不被内敛

@inline(__always) 开启编译器优化后，即使代码很长也会被内联（递归、动态派发除外）

#### 5、嵌套函数
#### 6、高阶函数
返回值是函数类型的函数，我称为高阶函数。
#### 7、柯里化
#### 8、关键字 inout
传递参数，加上inout标记表示参数可以被修改

inout就是地址传递
### 2、闭包
#### 1、尾随闭包
闭包作为最后一个参数，可以使用尾随闭包

#### 2、自动闭包

autoclosure

自动闭包可以省略闭包作为参数时闭包的括号
只支持 ()->T 这种类型的闭包

空合并运算符 `??`，就是使用的自动闭包

#### 3、逃逸闭包

## 三、值类型与引用类型
### 0、内存相关
#### 1、MemoryLayout
- size

实际使用大小

- stride

对齐后的大小

- alignment

对齐字节数

#### 2、MJ内存工具

### 1、枚举
关联值

枚举成员变量和其他类型的关联储存在一起

原始值

枚举成员变量可以使用相同类型的默认值预先关联

隐式原始值

递归枚举 indirect

#### 1、关联值
#### 2、内存分析
#### 3、switch 原理
### 2、结构体
#### 1、内存分析
#### 2、写时复制 Copy On Write
在swift标准库中，为了提升性能，String、Array、Dictionary、Set采取了Copy On Write

仅有当写操作时，才会真正执行拷贝操作
#### 3、inout 关键字
#### 4、mutating 关键字
#### 5、static 关键字

### 3、类
#### 1、内存分析
- 类信息：8字节
- 引用计数：8字节
- 参数：n字节
#### 2、属性重写
#### 3、class、static 关键字
#### 4、@objc 关键字
#### 5、@discardResult 关键字
#### 6、方法执行流程

### 4、属性
#### 1、存储属性
#### 2、计算属性
#### 3、属性观察器
willSet{}
didSet{}
#### 4、类型属性
static 

默认lazy、而且多线程安全
### 5、方法

## 四、面向协议编程
## 五、响应式编程
### 1、RXSwift
Observable 可以被订阅，可以被绑定到订阅者身上

Observable 传递的本身是个枚举，一个具有关联值的枚举，关联值是个泛型

### 2、Combine
## 六、与Objective-C\C++ 交互

重写函数名 @_silgen_name("x") func s_x

@objcmember

@objc()

为什么Swift暴露给OC的类最终要继承自Swift

